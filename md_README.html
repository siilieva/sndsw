<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SND@LHC Software: sndsw</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SND@LHC Software
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">sndsw </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Table of Contents</b></p>
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#contact-and-communication">Contact and communication</a></li>
<li><a href="#branches">Branches</a></li>
</ul>
</li>
<li><a href="#build-instructions">Build instructions</a><ul>
<li><a href="#on-lxplus-or-systems-with-cvmfs">On lxplus or systems with CVMFS</a></li>
<li><a href="#on-systems-without-access-to-cvmfs">On systems without access to CVMFS</a></li>
</ul>
</li>
<li><a href="#run-instructions">Run Instructions</a></li>
<li><a href="#docker-instructions">Docker Instructions</a></li>
<li><a href="#contributing-code">Contributing Code</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md21"></a>
Introduction</h1>
<p><code>sndsw</code> is the software framework of the SND@LHC collaboration. It is based on the <a href="https://github.com/ShipSoft/FairShip">FairShip</a> framework developed by the SHiP collaboration which in turn is based on <a href="https://github.com/FairRootGroup/FairRoot/">FairRoot</a>, making use of the automatic python bindings provided by PyROOT.</p>
<h2><a class="anchor" id="autotoc_md22"></a>
Contact and communication</h2>
<p>If you have questions or problems, please feel free to contact the @SND-LHC/core-developers. For troubleshooting and development, we plan to discuss on <a href="https://mattermost.web.cern.ch/sndlhc/channels/software">Mattermost</a>.</p>
<p>The <a href="#" onclick="location.href='mai'+'lto:'+'snd'+'-s'+'oft'+'wa'+'re@'+'ce'+'rn.'+'ch'; return false;">snd-software</a> mailing list can be used to discuss the software and report issues. Important annoucements will be made there.</p>
<p>The <a href="#" onclick="location.href='mai'+'lto:'+'snd'+'-s'+'oft'+'wa'+'re-'+'no'+'tif'+'ic'+'ati'+'on'+'s@c'+'er'+'n.c'+'h'; return false;">snd-software-notifications</a> mailing list will be used for automated notifications from Github and CI/CD etc..</p>
<p>Both mailing lists are self-subscribe CERN e-groups.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Branches</h2>
<dl>
<dt><code>master</code> </dt>
<dd>Main development branch. All python code is <b>required to be compatible with 3</b> Requires aliBuild default <code>release</code>. </dd>
</dl>
<h1><a class="anchor" id="autotoc_md24"></a>
Build instructions</h1>
<p>The <code>aliBuild</code> family of tools developed by ALICE is used to set up <code>sndsw</code> and its dependencies.</p>
<h3><a class="anchor" id="autotoc_md25"></a>
Introduction to &lt;tt&gt;aliBuild&lt;/tt&gt;</h3>
<p>The basic commands are the same regardless of whether CVMFS is used:</p>
<dl>
<dt><code>aliBuild build &lt;package-name&gt; -c snddist</code> </dt>
<dd>Build the package <code>&lt;package-name&gt;</code> (e.g. <code>sndsw</code>) and its dependencies using the recipes and configuration provided by snddist. On CVMFS, it is recommended to add <code>&ndash;always-prefer-system</code> to ensure packages are used from CVMFS instead of being rebuilt. </dd>
<dt><code>aliDoctor &lt;package-name&gt; -c snddist</code> </dt>
<dd>Provide troubleshooting information and hints on which packages can be used from the system for <code>&lt;package-name&gt;</code> and its dependencies. </dd>
<dt><code>alienv enter &lt;package-name&gt; /latest -c snddist</code> </dt>
<dd>Enter an environment with <code>&lt;package-name&gt;</code> and its dependencies. </dd>
</dl>
<p>For more information on using <code>aliBuild</code>, see its <a href="https://alisw.github.io/alibuild/">documentation</a> (note: some things are ALICE specific and will not apply to SND@LHC software).</p>
<h2><a class="anchor" id="autotoc_md26"></a>
On lxplus or systems with CVMFS</h2>
<p>On <code>lxplus</code> or any CC7/CC8 machine with access to CVMFS, you can do the following:</p>
<ol type="1">
<li>Make sure you can access the SNDLHC CVMFS Repository ```bash ls /cvmfs/sndlhc.cern.ch ``<code></code></li>
<li><code>Source the</code>setUp.sh&lt;tt&gt;script ``bash source /cvmfs/sndlhc.cern.ch/SNDLHC-2023/Aug30/setUp.sh # recommended latest version ```</li>
<li>If you don't want to modify the sndsw package, skip step 3: ```bash git clone <a href="https://github.com/SND-LHC/sndsw">https://github.com/SND-LHC/sndsw</a> ``` This gives you by default the master branch of the software. In case, you want to use a specific branch: ```bash cd sndsw git checkout &lt;branch&gt; cd .. ``<code></code></li>
<li><code>Build the software using</code>aliBuild<code> </code>``bash aliBuild build sndsw -c $SNDDIST &ndash;always-prefer-system &ndash;default release ``` If you exit your shell session and you want to go back working on it, make sure to re-execute the second step.</li>
</ol>
<p>To load the <code>sndsw</code> environment, after you build the software, you can simply use:</p>
<ol type="1">
<li>Load the environment ```bash alienv enter sndsw/latest ```</li>
</ol>
<p>However, this won't work if you are using HTCondor. In such case you can do:</p>
<div class="fragment"><div class="line">eval alienv load sndsw/latest</div>
</div><!-- fragment --><p>If you modify <code>sndsw</code>, simply repeat step 4 from <code>sndsw</code>'s parent directory.</p>
<p>Note for Ubuntu 20.04: currently there is a version (March 2022) of CVMFS built with Ubuntu 20.04. However, standard ubuntu 20.04 still have python2 has default, while we moved to python3. So, it is needed to do </p><div class="fragment"><div class="line">sudo apt-get install python-is-python3</div>
</div><!-- fragment --><p>Then, the above procedure works </p>
<h2><a class="anchor" id="autotoc_md27"></a>
On systems without access to CVMFS</h2>
<p>Commands are similar to the previous case, but without access to CVMFS you need to build the required packages from source.</p>
<ol type="1">
<li>Clone the <a href="https://github.com/SND-LHC/snddist">snddist</a>, which containts the recipes to build <code>sndsw</code> and it's dependencies: ```bash git clone <a href="https://github.com/SND-LHC/snddist.git">https://github.com/SND-LHC/snddist.git</a> ```</li>
<li>If you don't want to modify the sndsw package, skip step 2: ```bash git clone <a href="https://github.com/SND-LHC/sndsw">https://github.com/SND-LHC/sndsw</a> ``` This gives you by default the master branch of the software. In case, you want to use a specific branch: ```bash cd sndsw git checkout &lt;branch&gt; cd .. ```</li>
<li>Install <a href="https://github.com/alisw/alibuild">aliBuild</a> ``` bash pip3 install &ndash;user alibuild ``` and make sure that it is in your $PATH, or if you are administrator: ``` bash sudo pip3 install alibuild ```</li>
<li>Build the software using aliBuild ```bash aliBuild build sndsw -c snddist &ndash;default release ``<code> If you run into any problems,</code>aliDoctor` can help determine what the problem is.</li>
<li>Load the environment ```bash alienv enter sndsw/latest ```</li>
</ol>
<h1><a class="anchor" id="autotoc_md28"></a>
Run Instructions</h1>
<p>updated 11 October 2021 for the use with raw data</p>
<p>Set up the bulk of the environment from CVMFS.</p>
<div class="fragment"><div class="line">source /cvmfs/sndlhc.cern.ch/latest/setUp.sh </div>
</div><!-- fragment --><p>Load your local sndsw environment.</p>
<div class="fragment"><div class="line">alienv enter (--shellrc) sndsw/latest </div>
</div><!-- fragment --><div class="fragment"><div class="line">python $SNDSW_ROOT/shipLHC/run_simSND.py  --Ntuple  -n 100 -f /eos/experiment/sndlhc/MonteCarlo/FLUKA/muons_up/version1/unit30_Nm.root  --eMin 1.0</div>
<div class="line">&gt;&gt; Macro finished succesfully. </div>
</div><!-- fragment --> <blockquote class="doxtable">
<blockquote class="doxtable">
<p>Output files are sndLHC.Ntuple-TGeant4.root (events) and geofile_full.Ntuple-TGeant4.root (setup) </p>
</blockquote>
</blockquote>
<p>Run the event display:</p>
<div class="fragment"><div class="line">python -i $SNDSW_ROOT/macro/eventDisplay.py -f sndLHC.Ntuple-TGeant4.root -g geofile_full.Ntuple-TGeant4.root </div>
<div class="line">// use SHiP Event Display GUI </div>
<div class="line">Use quit() or Ctrl-D (i.e. EOF) to exit </div>
</div><!-- fragment --><p> a) Use the GUI to display events: SHiP actions / next event</p>
<p>b) Hoovering over trajectory will display additional information :</p>
<p>c) At python prompt: <a class="el" href="namespacedecorators.html#a3c7af73e472ea77e011ed0d4520bbbab">sTree.MCTrack.Dump()</a> will display info about all MC particles</p>
<h2><a class="anchor" id="autotoc_md29"></a>
Use cases covered by &lt;tt&gt;run_simSND.py&lt;/tt&gt;:</h2>
<ol type="1">
<li>Transport muons, output of FLUKA simulation, to TI18 and the detector. Positive and negative muons, up and down crossing angles, exist. Possible options are setting minimum energy for transporting particles, transport only muons, increase EM cross sections of muons.</li>
</ol>
<div class="fragment"><div class="line">python $SNDSW_ROOT/shipLHC/run_simSND.py  --Ntuple  -n nEvents  -f /eos/experiment/sndlhc/MonteCarlo/FLUKA/muons_up/version1/unit30_Nm.root  --eMin ecut</div>
</div><!-- fragment --><ol type="1">
<li>Muon deep inelastic scattering events, produced with pythia6, and then positioned in T18 and transported by Geant4: <div class="fragment"><div class="line">python  $SNDSW_ROOT/shipLHC/run_simSND.py  -F --MuDIS -n nEvents -f  /eos/experiment/sndlhc/MonteCarlo/Pythia6/MuonDIS/muonDis_1001.root  --eMin ecut</div>
</div><!-- fragment --></li>
<li>WORK ONGOING: Neutrino events, produced by GENIE, <a class="el" href="makeSNDGenieEvents_8py.html">sndsw/macro/makeSNDGenieEvents.py</a>, and then positioned in T18 and transported by Geant4: <div class="fragment"><div class="line">python  $SNDSW_ROOT/shipLHC/run_simSND.py  --Genie -n nEvents -f ...</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md30"></a>
Digitization of MC data:</h2>
<ol type="1">
<li>Convert MC points to detector hits. Input required, data from simulation together with the geometry file created when running simulation. New objects created are <code>Digi_ScifiHits</code> together with <code>Cluster_Scifi</code> and <code>Digi_MuFilterHit</code>, and in parallel objects to make the link to the original MC points, <code>Digi_MuFilterHits2MCPoints</code> and <code>Digi_ScifiHits2MCPoints</code>.</li>
</ol>
<div class="fragment"><div class="line">python $SNDSW_ROOT/shipLHC/run_digiSND.py   -f sndLHC.Ntuple-TGeant4.root -g geofile_full.Ntuple-TGeant4.root</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31"></a>
Converting raw data to sndsw format:</h2>
<ol type="1">
<li>Runs the calibration procedure and creates <code>Digi_ScifiHits</code> and <code>Digi_MuFilterHit</code> with signal and time information from SiPM channels.</li>
</ol>
<div class="fragment"><div class="line">python $SNDSW_ROOT/shipLHC/rawData/convertRawData.py -p /eos/experiment/sndlhc/testbeam/scifi-cosmic/ -r 35</div>
</div><!-- fragment --><ol type="1">
<li>For the <a class="el" href="classMuFilter.html">MuFilter</a> testbeam in H8, a specialized script needs to be used to also synchronize the readout boards.</li>
</ol>
<div class="fragment"><div class="line">python $SNDSW_ROOT/shipLHC/rawData/convertRawData_convertRawData_muTestbeam.py -p /eos/experiment/sndlhc/testbeam/MuFilter/TB_data_commissioning/ -n 5000000  -r 91</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md32"></a>
Example scripts for accessing the raw data and making histograms:</h2>
<ol type="1">
<li>For scifi data: <div class="fragment"><div class="line">python $SNDSW_ROOT/shipLHC/rawData/scifiHitMaps.py -p /eos/experiment/sndlhc/testbeam/scifi/sndsw/ -r 1 -g geofile_full.Ntuple-TGeant4.root </div>
</div><!-- fragment --></li>
<li>For MuFi data: <div class="fragment"><div class="line">python $SNDSW_ROOT/shipLHC/rawData/mufiHitMaps.py -p /eos/experiment/sndlhc/testbeam/MuFilter/TB_data_commissioning/sndsw/ -r 90 -g geofile_full.Ntuple-TGeant4.root </div>
</div><!-- fragment --> Two methods implemented, hitMaps(Nev = -1) and <a class="el" href="namespacemufiHitMaps.html#aaf61f493002a3f19a5e9384eac1c257e">eventTime()</a>.</li>
</ol>
<h2><a class="anchor" id="autotoc_md33"></a>
simple 2d event display with Scifi tracking:</h2>
<ol type="1">
<li>Use method loopEvents(start=0,save=False,goodEvents=False,withTrack=False) <div class="fragment"><div class="line">python $SNDSW_ROOT/shipLHC/scripts/scifiHitMaps.py -p /eos/experiment/sndlhc/testbeam/scifi/sndsw/ -r 1 -g geofile_full.Ntuple-TGeant4.root </div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="autotoc_md34"></a>
Docker Instructions</h1>
<p>Docker is <b>not</b> the recommended way to run <code>sndsw</code> locally. It is ideal for reproducing reproducible, stateless environments for debugging, HTCondor and cluster use, or when a strict separation between <code>sndsw</code> and the host is desirable.</p>
<ol type="1">
<li>Build an docker image from the provided <code>Dockerfile</code>: ```bash git clone <a href="https://github.com/SND-LHC/sndsw.git">https://github.com/SND-LHC/sndsw.git</a> cd sndsw docker build -t sndsw . ``<code></code></li>
<li><code>Run the</code>sndsw<code>docker image: </code>``bash docker run -i -t &ndash;rm sndsw /bin/bash ```</li>
<li>Advanced docker run options: ```bash docker run -i -t &ndash;rm \ -e DISPLAY=unix$DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix \ -v /local_workdir:/image_workdir \ sndsw /bin/bash ``<code> The option</code>-e DISPLAY=unix$DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix<code>forwards graphics from the docker to your local system (similar to</code>ssh -X<code>). The option</code>-v /local_workdir:/image_workdir<code>mounts</code>/local_workdir<code>on the local system as</code>/image_workdir` within docker.</li>
</ol>
<h1><a class="anchor" id="autotoc_md35"></a>
Contributing Code</h1>
<p>All packages are managed in Git and GitHub. Please either use the web interface to create pull requests or issues, or <a href="https://git-send-email.io/">send patches via email</a>.</p>
<p>If your changes would also benefit <a href="https://github.com/ShipSoft/FairShip">FairShip</a>, please consider making a pull-request for your changes there. We can then pick up the changes from FairShip automatically. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
